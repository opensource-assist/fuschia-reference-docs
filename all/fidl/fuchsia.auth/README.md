[TOC]

# fuchsia.auth


## **PROTOCOLS**

## AttestationSigner {#AttestationSigner}
*Defined in [fuchsia.auth/attestation_signer.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/attestation_signer.fidl#23)*


### SignData {#SignData}

<p>Cryptographically signs the <code>plaintext</code> data sent in request using a
crypto key configured at initialization.</p>
<p>Returns the raw bytes of the <code>signature</code> string on success. Otherwise,
an error status is returned.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>plaintext</code></td>
            <td>
                <code>vector&lt;uint8&gt;</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AttestationSignerStatus'>AttestationSignerStatus</a></code>
            </td>
        </tr><tr>
            <td><code>signature</code></td>
            <td>
                <code>vector&lt;uint8&gt;?</code>
            </td>
        </tr></table>

## AuthenticationUIContext {#AuthenticationUIContext}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#147)*

<p>This interface is implemented by base shell. It is used to notify the
base shell that a view for login needs to be started / stopped.</p>

### StartOverlay {#StartOverlay}

<p>Requests base shell to display <code>view_holder_token</code> for authentication.
Another call to StartOverlay() will not be made until StopOverlay()
has been called.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>view_holder_token</code></td>
            <td>
                <code><a class='link' href='../fuchsia.ui.views/'>fuchsia.ui.views</a>/<a class='link' href='../fuchsia.ui.views/#ViewHolderToken'>ViewHolderToken</a></code>
            </td>
        </tr></table>



### StopOverlay {#StopOverlay}

<p>Requests base shell to stop displaying the auth view.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    </table>



## AuthProvider {#AuthProvider}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#161)*

<p>OAuth identity service that provisions new users and provides authorization
tokens for the currently enrolled users. Some common Auth Providers are
Google, Facebook, Spotify and Twitter.</p>

### GetPersistentCredential {#GetPersistentCredential}

<p>Authenticates and authorizes a user against an auth provider backend system
using the OAuth protocol and returns the persistent credential such as
Google's refresh token or Facebook's access token for this user. These
persistent credentials are long lived and their expiration time is set by
the identity provider, for example Google's refresh tokens are valid until
the user changes their password or revokes access explicitly, whereas
Facebook access tokens are valid for up to 60 days or until the user
revokes access.</p>
<p>During OAuth handshake, user needs to explicitly consent to the permissions
as configured at the server. The consent is presented in a web_view using
an <code>auth_ui_context</code> overlay provided by the base_shell.</p>
<p>An optional <code>user_profile_id</code> is provided for simplifying reauthorization
flow.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>auth_ui_context</code></td>
            <td>
                <code><a class='link' href='#AuthenticationUIContext'>AuthenticationUIContext</a>?</code>
            </td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AuthProviderStatus'>AuthProviderStatus</a></code>
            </td>
        </tr><tr>
            <td><code>credential</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr><tr>
            <td><code>user_profile_info</code></td>
            <td>
                <code><a class='link' href='#UserProfileInfo'>UserProfileInfo</a>?</code>
            </td>
        </tr></table>

### GetAppAccessToken {#GetAppAccessToken}

<p>Exchanges a persistent user <code>credential</code> for a short lived app specific
OAuth access token for the specified <code>client_id</code> and <code>scopes</code>. The
<code>credential</code> is a long lived OAuth token as generated by the external
identity provider in the above GetPersistentCredential() call. If no
client_id is specified a default will be used.</p>
<p>Access tokens are used by applications to make API requests against
services offered by the Auth Provider.</p>
<p>Returns an <code>auth_token</code> response containing an access token, if successful.
Otherwise, an error status is returned.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>credential</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>client_id</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr><tr>
            <td><code>scopes</code></td>
            <td>
                <code>vector&lt;string&gt;</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AuthProviderStatus'>AuthProviderStatus</a></code>
            </td>
        </tr><tr>
            <td><code>auth_token</code></td>
            <td>
                <code><a class='link' href='#AuthToken'>AuthToken</a>?</code>
            </td>
        </tr></table>

### GetAppIdToken {#GetAppIdToken}

<p>Exchanges a persistent user <code>credential</code> for an OAuth Identity token for
the specified <code>audience</code>. The audience is the intended recipient of the
id_token. The <code>credential</code> is a long lived OAuth token as generated by the
external identity provider in the above GetPersistentCredential() call.</p>
<p>OAuth Id tokens are JSON Web Tokens (JWT) that contains digitally signed
identity information about the user for the intended recipient.</p>
<p>Returns an <code>auth_token</code> response containing an id token, if successful.
Otherwise, an error status is returned.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>credential</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>audience</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AuthProviderStatus'>AuthProviderStatus</a></code>
            </td>
        </tr><tr>
            <td><code>auth_token</code></td>
            <td>
                <code><a class='link' href='#AuthToken'>AuthToken</a>?</code>
            </td>
        </tr></table>

### GetAppFirebaseToken {#GetAppFirebaseToken}

<p>Gets a firebase auth token for the user identified by <code>id_token</code> and the
requested |firebase_api key|. The <code>id_token</code> is a JWT Identity token
returned from GetAppIdToken() call above.</p>
<p>Returns a <code>firebase_token</code> from the server if successful. Otherwise, an
error status is returned.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>id_token</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>firebase_api_key</code></td>
            <td>
                <code>string</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AuthProviderStatus'>AuthProviderStatus</a></code>
            </td>
        </tr><tr>
            <td><code>firebase_token</code></td>
            <td>
                <code><a class='link' href='#FirebaseToken'>FirebaseToken</a>?</code>
            </td>
        </tr></table>

### RevokeAppOrPersistentCredential {#RevokeAppOrPersistentCredential}

<p>Revokes user's grants at the Auth Provider by revoking a credential. The
<code>credential</code> is either a long lived OAuth token as returned by the
GetPersistentCredential() call or an app specific access token as returned
by the GetAppAccessToken() call.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>credential</code></td>
            <td>
                <code>string</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AuthProviderStatus'>AuthProviderStatus</a></code>
            </td>
        </tr></table>

### GetPersistentCredentialFromAttestationJWT {#GetPersistentCredentialFromAttestationJWT}

<p>Authenticates and authorizes a user against a remote attestation based
auth provider backend system that mints bound persistent credentials.</p>
<p>This method is capable of performing user authorization directly on the
device or use the OAuth authorization code generated out-of-band on a
secondary device that is sent over a secure channel to the target device.
In the latter case, auth_code generated out-of-band is passed as an
argument in the attestation <code>jwt_params</code>. Where as in the former case,
user needs to explicitly consent to the permissions on the target device
and the auth_code is returned to the device directly. The consent is
presented in a web_view using an <code>auth_ui_context</code> overlay provided by the
base_shell. An optional <code>user_profile_id</code> is provided for simplifying
reauthorization flow.</p>
<p>The authorization code is exchanged to a bound refresh token using an
attestation JWT constructed from <code>jwt_params</code> and is signed by the
<code>attestation_signer</code> component passed in the request.</p>
<p>If the operation is successful, a long-lived <code>credential</code> that is bound to
the originating device is returned along with an optional <code>auth_token</code>
containing short-lived access token and an optional <code>nonce</code> that is used on
next token exchange request. An optional <code>user_profile_info</code> containing
user profile attributes is also returned if successful. Otherwise, an error
status is returned.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>attestation_signer</code></td>
            <td>
                <code><a class='link' href='#AttestationSigner'>AttestationSigner</a></code>
            </td>
        </tr><tr>
            <td><code>jwt_params</code></td>
            <td>
                <code><a class='link' href='#AttestationJWTParams'>AttestationJWTParams</a></code>
            </td>
        </tr><tr>
            <td><code>auth_ui_context</code></td>
            <td>
                <code><a class='link' href='#AuthenticationUIContext'>AuthenticationUIContext</a>?</code>
            </td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AuthProviderStatus'>AuthProviderStatus</a></code>
            </td>
        </tr><tr>
            <td><code>credential</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr><tr>
            <td><code>auth_token</code></td>
            <td>
                <code><a class='link' href='#AuthToken'>AuthToken</a>?</code>
            </td>
        </tr><tr>
            <td><code>auth_challenge</code></td>
            <td>
                <code><a class='link' href='#AuthChallenge'>AuthChallenge</a>?</code>
            </td>
        </tr><tr>
            <td><code>user_profile_info</code></td>
            <td>
                <code><a class='link' href='#UserProfileInfo'>UserProfileInfo</a>?</code>
            </td>
        </tr></table>

### GetAppAccessTokenFromAssertionJWT {#GetAppAccessTokenFromAssertionJWT}

<p>Exchanges a bound persistent user <code>credential</code> for a short lived app
specific OAuth access token using the specified assertion JWT. The
assertion JWT is constructed from <code>jwt_params</code> and is signed by the
<code>attestation_signer</code> component passed in the request.</p>
<p>Access tokens are used by applications to make API requests against
services offered by the Auth Provider.</p>
<p>Returns an <code>auth_token</code> response containing an access token and an optional
<code>updated_credential</code> and <code>auth_challenge</code> to be used on next token refresh
request, if successful. Otherwise, an error status is returned.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>attestation_signer</code></td>
            <td>
                <code><a class='link' href='#AttestationSigner'>AttestationSigner</a></code>
            </td>
        </tr><tr>
            <td><code>jwt_params</code></td>
            <td>
                <code><a class='link' href='#AssertionJWTParams'>AssertionJWTParams</a></code>
            </td>
        </tr><tr>
            <td><code>credential</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>scopes</code></td>
            <td>
                <code>vector&lt;string&gt;</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#AuthProviderStatus'>AuthProviderStatus</a></code>
            </td>
        </tr><tr>
            <td><code>updated_credential</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr><tr>
            <td><code>auth_token</code></td>
            <td>
                <code><a class='link' href='#AuthToken'>AuthToken</a>?</code>
            </td>
        </tr><tr>
            <td><code>auth_challenge</code></td>
            <td>
                <code><a class='link' href='#AuthChallenge'>AuthChallenge</a>?</code>
            </td>
        </tr></table>

## AuthenticationContextProvider {#AuthenticationContextProvider}
*Defined in [fuchsia.auth/token_manager.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/token_manager.fidl#95)*

<p>Implemented by a privileged system component with the ability to display UI
to the end user.</p>
<p>This is provided during the initialization of TokenManager service and is
used for any subsequent authorize calls. The UI contexts created by this
interface are used to display OAuth login and permission screens to the end
user.</p>

### GetAuthenticationUIContext {#GetAuthenticationUIContext}


#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>request</code></td>
            <td>
                <code>request&lt;<a class='link' href='#AuthenticationUIContext'>AuthenticationUIContext</a>&gt;</code>
            </td>
        </tr></table>



## TokenManagerFactory {#TokenManagerFactory}
*Defined in [fuchsia.auth/token_manager.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/token_manager.fidl#103)*

<p>This interface provides a discoverable mechanism to create TokenManager
instances for each user, and to supply auth provider configuration
information using the structs defined in <code>auth_provider.fidl</code>.</p>

### GetTokenManager {#GetTokenManager}

<p>Creates an OAuth TokenManager instance scoped for the component specified
by <code>application_url</code>, the Fuchsia user specified by <code>user_id</code>, and the list
of auth providers specified in <code>auth_provider_configs</code>.</p>
<p><code>auth_context_provider</code> is used to generate AuthenticationUIContexts during
TokenManager methods that require UI, unless the caller of those methods
supplies an alternative AuthenticationUIContext.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>user_id</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>application_url</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>auth_provider_configs</code></td>
            <td>
                <code>vector&lt;<a class='link' href='#AuthProviderConfig'>AuthProviderConfig</a>&gt;</code>
            </td>
        </tr><tr>
            <td><code>auth_context_provider</code></td>
            <td>
                <code><a class='link' href='#AuthenticationContextProvider'>AuthenticationContextProvider</a></code>
            </td>
        </tr><tr>
            <td><code>token_manager</code></td>
            <td>
                <code>request&lt;<a class='link' href='#TokenManager'>TokenManager</a>&gt;</code>
            </td>
        </tr></table>



## TokenManager {#TokenManager}
*Defined in [fuchsia.auth/token_manager.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/token_manager.fidl#127)*

<p>This interface manages OAuth tokens at the Fuchsia system level for different
auth identity providers.</p>
<p>If user authorization is required for minting tokens, TokenManager uses the
<code>auth_context_provider's</code> UI context for displaying OAuth UI to the end user.</p>
<p>After initialization, TokenManager handles are typically handed out by
Framework to components like Ledger and Agents. These components fetch
OAuth tokens from any configured auth provider, and use the
<code>auth_context_provider</code> initialized above for new authorizations.</p>

### Authorize {#Authorize}

<p>The first step of OAuth is to get authorization from the user. For Fuchsia
components, this is accomplished by displaying OAuth permissions in a view
provided by the caller. This view will use <code>auth_ui_context</code> if supplied,
or the <code>auth_context_provider</code> supplied at TokenManager creation if not.
The component's OAuth configuration is provided in <code>app_config</code> and
<code>app_scopes</code>. An optional <code>user_profile_id</code> that uniquely identifies an
account for a given auth provider may be provided to identify an existing
account during a re-auth flow.</p>
<p>IoT ID authorization includes a mode where the user authorizes on a second
device and that device acquires an auth code from the auth provider.
In this mode, the auth code may be supplied in <code>auth_code</code> and no local
user interface will be displayed.</p>
<p>After the user has successfully authorized, Token manager receives and
securely stores a persistent credential, such as an OAuth refresh token,
for the intended scopes. TokenManager later uses this credential for
minting short lived tokens.</p>
<p>If the operation is successful, an OK status is returned along with user
profile information in <code>user_profile_info</code> such as the user's email,
image_url, profile_url, and first and last names as configured on the auth
provider backend system.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>app_config</code></td>
            <td>
                <code><a class='link' href='#AppConfig'>AppConfig</a></code>
            </td>
        </tr><tr>
            <td><code>auth_ui_context</code></td>
            <td>
                <code><a class='link' href='#AuthenticationUIContext'>AuthenticationUIContext</a>?</code>
            </td>
        </tr><tr>
            <td><code>app_scopes</code></td>
            <td>
                <code>vector&lt;string&gt;</code>
            </td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr><tr>
            <td><code>auth_code</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#Status'>Status</a></code>
            </td>
        </tr><tr>
            <td><code>user_profile_info</code></td>
            <td>
                <code><a class='link' href='#UserProfileInfo'>UserProfileInfo</a>?</code>
            </td>
        </tr></table>

### GetAccessToken {#GetAccessToken}

<p>Returns a downscoped access token from an auth provider for the given user
<code>user_profile_id</code> and <code>scopes</code> to a Fuchsia component. The component's
OAuth configuration is provided in <code>app_config</code> and the <code>user_profile_id</code>
is the unique user identifier returned by the Authorize() call.</p>
<p>In the interests of performance, Token Manager does not place the supplied
scopes in a canonical order during caching. To benefit from caching of
tokens, clients must request the same scopes in the same order across
calls.</p>
<p>The access token is returned from cache if possible, otherwise the auth
provider is used to exchange the persistent credential for a new access
token.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>app_config</code></td>
            <td>
                <code><a class='link' href='#AppConfig'>AppConfig</a></code>
            </td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>app_scopes</code></td>
            <td>
                <code>vector&lt;string&gt;</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#Status'>Status</a></code>
            </td>
        </tr><tr>
            <td><code>access_token</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr></table>

### GetIdToken {#GetIdToken}

<p>Returns a JWT identity token from an auth provider to a Fuchsia component
intended for the given <code>audience</code>. The component's OAuth configuration is
supplied in <code>app_config</code>, the intended recipient of the id_token is
supplied in <code>audience</code>, and <code>user_profile_id</code> is a unique account
identifier returned by the Authorize() or ListProfileIds() calls.</p>
<p><code>user_profile_id</code> is the unique user identifier returned by the
Authorize() call.</p>
<p>The identity token is returned from cache if possible, otherwise the auth
provider is used to exchange the persistant credential for a new identity
token.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>app_config</code></td>
            <td>
                <code><a class='link' href='#AppConfig'>AppConfig</a></code>
            </td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>audience</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#Status'>Status</a></code>
            </td>
        </tr><tr>
            <td><code>id_token</code></td>
            <td>
                <code>string?</code>
            </td>
        </tr></table>

### GetFirebaseToken {#GetFirebaseToken}

<p>Returns a Firebase token from an auth provider for the given account and
Fuchsia component, and Firebase client. The component's OAuth configuration
is supplied in <code>app_config</code>, the Firebase client is supplied in
<code>firebase_api_key</code>, and <code>user_profile_id</code> is a unique account identifier
returned by the Authorize() or ListProfileIds() calls.</p>
<p>This api invokes firebase auth's VerifyAssertion endpoint that takes an
OAuth IdToken as the fuchsia.ui.input. Audience is the intended recipient
of the firebase id token.</p>
<p>The Firebase auth token is returned from cache if possible, otherwise it is
refreshed from the auth provider.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>app_config</code></td>
            <td>
                <code><a class='link' href='#AppConfig'>AppConfig</a></code>
            </td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>audience</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>firebase_api_key</code></td>
            <td>
                <code>string</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#Status'>Status</a></code>
            </td>
        </tr><tr>
            <td><code>firebase_token</code></td>
            <td>
                <code><a class='link' href='#FirebaseToken'>FirebaseToken</a>?</code>
            </td>
        </tr></table>

### DeleteAllTokens {#DeleteAllTokens}

<p>Deletes and revokes all long lived and short lived tokens generated for
an account and on behalf of a Fuchsia component. The component's OAuth
configuration is provided in <code>app_config</code> and <code>user_profile_id</code>
is a unique account identifier returned by the Authorize() or
ListProfileIds() calls.</p>
<p>Deletion of tokens involves three steps:</p>
<ol>
<li>Revoking credentials remotely at the auth provider.</li>
<li>Deleting short lived tokens from the in-memory cache.</li>
<li>Deleting persistent credentials stored locally on disk.</li>
</ol>
<p>If <code>force</code> is false then a failure at step 1 will terminate the method,
ensuring client and server state remain consistent. If <code>force</code> is true
then steps 2&amp;3 will be performed and the method will return OK even if
step 1 fails, ensuring the local credentials are wiped in all
circumstances.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>app_config</code></td>
            <td>
                <code><a class='link' href='#AppConfig'>AppConfig</a></code>
            </td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string</code>
            </td>
        </tr><tr>
            <td><code>force</code></td>
            <td>
                <code>bool</code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#Status'>Status</a></code>
            </td>
        </tr></table>

### ListProfileIds {#ListProfileIds}

<p>Returns a vector of all currently authorized user_profile_ids for a
component's OAuth configuration provided in <code>app_config</code>.</p>

#### Request
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>app_config</code></td>
            <td>
                <code><a class='link' href='#AppConfig'>AppConfig</a></code>
            </td>
        </tr></table>


#### Response
<table>
    <tr><th>Name</th><th>Type</th></tr>
    <tr>
            <td><code>status</code></td>
            <td>
                <code><a class='link' href='#Status'>Status</a></code>
            </td>
        </tr><tr>
            <td><code>user_profile_ids</code></td>
            <td>
                <code>vector&lt;string&gt;</code>
            </td>
        </tr></table>



## **STRUCTS**

### AuthToken {#AuthToken}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#35)*



<p>OAuth token response populated after parsing JSON object that contains
short-lived access token or id token returned by the auth provider.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>token_type</code></td>
            <td>
                <code><a class='link' href='#TokenType'>TokenType</a></code>
            </td>
            <td><p>Type of token.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>token</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Contains access token or a JWT identity token.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>expires_in</code></td>
            <td>
                <code>uint64</code>
            </td>
            <td><p>The remaining lifetime of the token in seconds.</p>
</td>
            <td>No default</td>
        </tr>
</table>

### FirebaseToken {#FirebaseToken}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#51)*



<p>Stores attributes related to a firebase auth token for a given firebase api
key.</p>
<p>These tokens are minted by Firebase Auth server and are meant to be used for
authorizing users into Firebase services such as DB and storage.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>id_token</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Use this as the auth token in firebase database and storage requests.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>local_id</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>Use this to uniquely identify users.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>email</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>Use this to uniquely identify user's email address provided by the
Auth Provider Firebase server.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>expires_in</code></td>
            <td>
                <code>uint64</code>
            </td>
            <td><p>The remaining lifetime of the token in seconds.</p>
</td>
            <td>No default</td>
        </tr>
</table>

### AuthChallenge {#AuthChallenge}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#68)*



<p>Challenge response returned by the auth provider during remote attestation
based authentication.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>challenge</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>The value of nonce to be used for the next token refresh request</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>expires_in</code></td>
            <td>
                <code>uint64</code>
            </td>
            <td><p>The lifetime of <code>challenge</code> in seconds.</p>
</td>
            <td>No default</td>
        </tr>
</table>

### CredentialECKey {#CredentialECKey}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#77)*



<p>Stores Elliptic Curve public key parameters of the credential key.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>curve</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Supported elliptic curve value used in JWT attestation. Refer to Section
6.2.1.1 of RFC7518 for the canonical list of supported elliptic curves.
For example:(P-256,P-384,P-521)</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>key_x_val</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Value of x of the generated EC key</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>key_y_val</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Value of y of the generated EC key</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>fingerprint_sha_256</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Base64 encoded SHA256 hash of the EC public key</p>
</td>
            <td>No default</td>
        </tr>
</table>

### AttestationJWTParams {#AttestationJWTParams}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#95)*



<p>Contains parameters required by the auth provider component to build
attestation JWTs.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>credential_eckey</code></td>
            <td>
                <code><a class='link' href='#CredentialECKey'>CredentialECKey</a></code>
            </td>
            <td><p>Contains the ephemeral Elliptic curve credential public key which will be
bound to the newly generated refresh token grant.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>certificate_chain</code></td>
            <td>
                <code>vector&lt;string&gt;</code>
            </td>
            <td><p>The full chain of certificates from the device attestation certificate
to the root certificate that was registered on the OAuth client id.
Each string should be base64-encoded DER PKIX certificate value.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>auth_code</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>OAuth authorization code bound to the given user and device</p>
</td>
            <td>No default</td>
        </tr>
</table>

### AssertionJWTParams {#AssertionJWTParams}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#110)*



<p>Contains parameters required by the auth provider to build assertion JWTs.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>credential_eckey</code></td>
            <td>
                <code><a class='link' href='#CredentialECKey'>CredentialECKey</a></code>
            </td>
            <td><p>Contains Elliptic curve credential public key which is bound to existing
refresh token.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>challenge</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>An optional challenge that could be used for the next token refresh request</p>
</td>
            <td>No default</td>
        </tr>
</table>

### UserProfileInfo {#UserProfileInfo}
*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#122)*



<p>User attributes returned to callers on authorizing a new user at any auth
provider. These attributes are generated by calling the auth provider's
user profile apis.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>id</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>User identifier returned by the backend identity provider server to
identify the user after successful authorization. Some identity providers
send verified email address as the identifier, and some send an opaque
string as the user identifier.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>display_name</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>The name that is displayed on the base shell while logging in. Display
name is fetched from user profile attributes as configured by the user at
the given identity provider.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>url</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>User's profile url that is used by the base shell while logging in.
Profile url is fetched from user profile attributes as configured by the
user at the given identity provider.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>image_url</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>User's profile image url that is used by the base shell while logging in.
Profile image url is fetched from user profile attributes as configured by
the user at the given identity provider.</p>
</td>
            <td>No default</td>
        </tr>
</table>

### ServiceProviderAccount {#ServiceProviderAccount}
*Defined in [fuchsia.auth/common.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/common.fidl#14)*



<p>A unique identifier for an account with some service provider, comprised of
the identity of the service provider and an account identity supplied by that
service provider.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>identity_provider_domain</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>The primary domain of the identity provider, such as &quot;www.google.com&quot;.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>user_profile_id</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>User identifier as supplied by the identity provider. Some identity
providers send verified email address as the identifier, some send an
opaque string.</p>
</td>
            <td>No default</td>
        </tr>
</table>

### AuthProviderConfig {#AuthProviderConfig}
*Defined in [fuchsia.auth/token_manager.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/token_manager.fidl#49)*



<p>Stores configuration parameters required to connect to available
<code>AuthProvider</code>s. It is used by TokenManager to instantiate all auth providers
during startup.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>auth_provider_type</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Type of OAuth Identity provider. An identity provider authenticates and
authorizes users for accessing their services. They also provide unique
identifiers for users to interact with the system and may provide
information about the user that is known to the provider.</p>
<p>Sample auth provider types include:
Dev : An identity provider that's used for development and testing.
Google: Uses Google as the identity provider. Authorization from Google
requires a working network connection and a web view.
Spotify: Uses Spotify as an identity provider.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>url</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>Url of the Fuchsia component implementing the AuthProvider.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>params</code></td>
            <td>
                <code>vector&lt;string&gt;?</code>
            </td>
            <td><p>Optional parameters specified during AuthProvider startup.</p>
</td>
            <td>No default</td>
        </tr>
</table>

### AppConfig {#AppConfig}
*Defined in [fuchsia.auth/token_manager.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/token_manager.fidl#71)*



<p>Stores OAuth configuration details for a given client application. These
details are used in the OAuth authorization step.</p>


<table>
    <tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr><tr>
            <td><code>auth_provider_type</code></td>
            <td>
                <code>string</code>
            </td>
            <td><p>An OAuth identity provider matching a configuration set in
AuthProviderConfig.auth_provider_type.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>client_id</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>OAuth client id.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>client_secret</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>OAuth client secret.
This field is optional and will only be used on calls to Authorize.</p>
</td>
            <td>No default</td>
        </tr><tr>
            <td><code>redirect_uri</code></td>
            <td>
                <code>string?</code>
            </td>
            <td><p>OAuth application's redirect uri.
This field is optional and will only be used on calls to Authorize.</p>
</td>
            <td>No default</td>
        </tr>
</table>



## **ENUMS**

### AttestationSignerStatus {#AttestationSignerStatus}
Type: <code>uint32</code>

*Defined in [fuchsia.auth/attestation_signer.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/attestation_signer.fidl#12)*

<p>This file contains an interface to cryptographically sign any plain text data
using any crypto key. This interface is useful for signing JWT's in device
attestation based authentication.</p>
<p>Specifies the success/failure status from the attestation signer.</p>


<table>
    <tr><th>Name</th><th>Value</th><th>Description</th></tr><tr>
            <td><code>OK</code></td>
            <td><code>0</code></td>
            <td><p>The command completed successfully</p>
</td>
        </tr><tr>
            <td><code>INVALID_ARGUMENT</code></td>
            <td><code>1</code></td>
            <td><p>The command referred to a missing, or an invalid argument.</p>
</td>
        </tr><tr>
            <td><code>SIGNING_ERROR</code></td>
            <td><code>2</code></td>
            <td><p>There was an error in generating crypto signatures for the given
plaintext. This usually indicates errors for misconfigured keys or
signature algorithms from the underlying crypto library.</p>
</td>
        </tr></table>

### AuthProviderStatus {#AuthProviderStatus}
Type: <code>uint32</code>

*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#14)*

<p>Specifies the success/failure status from auth provider.</p>


<table>
    <tr><th>Name</th><th>Value</th><th>Description</th></tr><tr>
            <td><code>OK</code></td>
            <td><code>0</code></td>
            <td></td>
        </tr><tr>
            <td><code>BAD_REQUEST</code></td>
            <td><code>1</code></td>
            <td></td>
        </tr><tr>
            <td><code>BAD_RESPONSE</code></td>
            <td><code>2</code></td>
            <td></td>
        </tr><tr>
            <td><code>OAUTH_SERVER_ERROR</code></td>
            <td><code>3</code></td>
            <td></td>
        </tr><tr>
            <td><code>USER_CANCELLED</code></td>
            <td><code>4</code></td>
            <td></td>
        </tr><tr>
            <td><code>REAUTH_REQUIRED</code></td>
            <td><code>5</code></td>
            <td></td>
        </tr><tr>
            <td><code>NETWORK_ERROR</code></td>
            <td><code>6</code></td>
            <td></td>
        </tr><tr>
            <td><code>UNSUPPORTED_PROVIDER</code></td>
            <td><code>7</code></td>
            <td></td>
        </tr><tr>
            <td><code>INTERNAL_ERROR</code></td>
            <td><code>8</code></td>
            <td></td>
        </tr><tr>
            <td><code>UNKNOWN_ERROR</code></td>
            <td><code>9</code></td>
            <td></td>
        </tr></table>

### TokenType {#TokenType}
Type: <code>uint32</code>

*Defined in [fuchsia.auth/auth_provider.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/auth_provider.fidl#28)*

<p>The type of token returned.</p>


<table>
    <tr><th>Name</th><th>Value</th><th>Description</th></tr><tr>
            <td><code>ACCESS_TOKEN</code></td>
            <td><code>0</code></td>
            <td></td>
        </tr><tr>
            <td><code>ID_TOKEN</code></td>
            <td><code>1</code></td>
            <td></td>
        </tr></table>

### Status {#Status}
Type: <code>uint32</code>

*Defined in [fuchsia.auth/token_manager.fidl](https://fuchsia.googlesource.com/fuchsia/+/master/sdk/fidl/fuchsia.auth/token_manager.fidl#8)*

<p>Specifies the success/failure status of TokenManager calls.</p>


<table>
    <tr><th>Name</th><th>Value</th><th>Description</th></tr><tr>
            <td><code>OK</code></td>
            <td><code>0</code></td>
            <td><p>The command completed successfully</p>
</td>
        </tr><tr>
            <td><code>AUTH_PROVIDER_SERVICE_UNAVAILABLE</code></td>
            <td><code>1</code></td>
            <td><p>The command referred to a missing, misconfigured, or failed auth provider.
Retrying is not recommended.</p>
</td>
        </tr><tr>
            <td><code>AUTH_PROVIDER_SERVER_ERROR</code></td>
            <td><code>2</code></td>
            <td><p>The auth server was reachable but responded with an error. These errors
are typically caused by a configuration problem or a revoked token and so
should not be retried.</p>
</td>
        </tr><tr>
            <td><code>INTERNAL_ERROR</code></td>
            <td><code>3</code></td>
            <td><p>An internal error occurred. This usually indicates a bug within the Token
Manager itself. Retry is optional.</p>
</td>
        </tr><tr>
            <td><code>INVALID_AUTH_CONTEXT</code></td>
            <td><code>4</code></td>
            <td><p>An invalid or non-functional AuthContextProvider was provided. Retrying is
unlikely to correct this error.</p>
</td>
        </tr><tr>
            <td><code>INVALID_REQUEST</code></td>
            <td><code>5</code></td>
            <td><p>The request was malformed in some way, such as using an empty string for
the user_profile_id. The request should not be retried.</p>
</td>
        </tr><tr>
            <td><code>USER_NOT_FOUND</code></td>
            <td><code>6</code></td>
            <td><p>The requested user profile could not be found in the database. The request
should not be retried.</p>
</td>
        </tr><tr>
            <td><code>IO_ERROR</code></td>
            <td><code>7</code></td>
            <td><p>A local error occurred such as disk I/O or memory allocation. Retry, after
a delay, is recommended.</p>
</td>
        </tr><tr>
            <td><code>UNKNOWN_ERROR</code></td>
            <td><code>8</code></td>
            <td><p>Some other problem occurred that cannot be classified using one of the more
specific statuses. Retry is optional.</p>
</td>
        </tr><tr>
            <td><code>REAUTH_REQUIRED</code></td>
            <td><code>9</code></td>
            <td><p>The auth server requires that the user reauthenticate. The client should
call the Authorize method.</p>
</td>
        </tr><tr>
            <td><code>USER_CANCELLED</code></td>
            <td><code>10</code></td>
            <td><p>The user cancelled the flow. User consent is required before any retry.</p>
</td>
        </tr><tr>
            <td><code>NETWORK_ERROR</code></td>
            <td><code>11</code></td>
            <td><p>A network error occurred while communicating with the auth server. Retry,
after a delay, is recommended.</p>
</td>
        </tr></table>













